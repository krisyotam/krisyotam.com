/* =============================================================================
   BASE TAILWIND IMPORTS
   ========================================================================== */
   @import 'katex/dist/katex.min.css';
   @import './styles/themes/index.css';
   @import './styles/core/content.css';
   @tailwind base;
   @tailwind components;
   @tailwind utilities;
   
   /* =============================================================================
      CODE BLOCK STYLES
      ========================================================================== */
   .code-block pre {
     margin: 0;
     padding: 0;
     overflow-x: auto;
   }
   
   /* Improved line numbers styling with clear separation */
   .code-container span[style*="userSelect"] {
     user-select: none !important;
     border-right: 1px solid rgba(127, 127, 127, 0.25) !important;
     margin-right: 1em !important;
     padding-right: 1em !important;
     opacity: 0.6 !important;
     min-width: 3em !important;
     text-align: right !important;
     display: inline-block !important;
     position: sticky;
     left: 0;
     background: inherit;
   }
   
   /* Fix for line number display in native code blocks */
   .code-container span[style*="display: block"] {
     display: flex !important;
     min-width: 100% !important;
   }
   
   /* Ensure code content doesn't overlap line numbers */
   .code-container span[style*="display: block"] > span:last-child {
     padding-left: 1em !important;
     flex: 1 !important;
     min-width: 0 !important;
   }
   
   /* Make line numbers container fixed width */
   .code-container .linenumber {
     min-width: 3em !important;
     max-width: 3em !important;
     text-align: right !important;
     padding-right: 1em !important;
     border-right: 1px solid rgba(127, 127, 127, 0.25) !important;
     margin-right: 1em !important;
     opacity: 0.6 !important;
     user-select: none !important;
     position: sticky;
     left: 0;
     background: inherit;
   }
   
   /* Specific fix for making sure line numbers don't get colored by syntax highlighting */
   .code-container .react-syntax-highlighter-line-number {
     color: rgba(127, 127, 127, 0.6) !important;
     background: transparent !important;
   }
   
   /* Fix alignment of code */
   .code-container pre {
     margin: 0 !important;
     padding: 0 !important;
   }
   
   /* Code content alignment fix */
   .syntax-line {
     display: flex !important; 
     width: 100% !important;
     min-width: 100% !important;
   }
   
   /* Line number column styling */
   .syntax-line span:first-child {
     flex: 0 0 auto !important;
     text-align: right !important;
     padding-right: 1em !important;
     min-width: 3em !important;
     width: 3em !important;
     border-right: 1px solid rgba(127, 127, 127, 0.2) !important;
     margin-right: 1em !important;
     user-select: none !important;
     position: sticky;
     left: 0;
     background: inherit;
   }
   
   /* Code content column styling */
   .syntax-line span:last-child {
     flex: 1 1 auto !important;
     padding-left: 1em !important;
     min-width: 0 !important;
     overflow-wrap: break-word !important;
   }
   
   /* Force proper display for syntax highlighting wrapper */
   .code-block-wrapper {
     position: relative;
     display: block;
     width: 100%;
   }
   
   /* Make code blocks scroll nicely on smaller screens */
   .code-container::-webkit-scrollbar {
     /* Allow custom sizing from component */
   }
   
   .code-container::-webkit-scrollbar-track {
     background: transparent;
   }
   
   .code-container::-webkit-scrollbar-thumb {
     background-color: rgba(127, 127, 127, 0.4);
     border-radius: 3px;
   }
   
   /* Native code block styling */
   pre code.hljs {
     display: block;
     padding: 0;
     overflow-x: auto;
     font-family: var(--font-mono), 'IBM Plex Mono', ui-monospace, Menlo, monospace;
     font-size: 0.875rem;
     line-height: 1.5;
   }
   
   /* Light and dark theme for code */
   :is(.light) pre code.hljs {
     color: #24292e; /* GitHub-like dark text */
     background: transparent;
   }
   
   :is(.dark) pre code.hljs {
     color: #e1e4e8; /* GitHub-like light text */
     background: transparent;
   }
   
   /* Scrollbar styling for native code blocks */
   pre::-webkit-scrollbar {
     /* Allow custom sizing from component */
   }
   
   pre::-webkit-scrollbar-track {
     background: transparent;
   }
   
   pre::-webkit-scrollbar-thumb {
     background-color: rgba(127, 127, 127, 0.4);
     border-radius: 3px;
   }
   
   /* =============================================================================
      COLOR THEME VARIABLES
      ========================================================================== */
   /* Theme variables are now imported from ./styles/themes/index.css */
   
   /* =============================================================================
      BASE ELEMENT STYLES
      ========================================================================== */
   @layer base {
     * {
       @apply border-border;
     }
   
     body {
       @apply bg-background text-foreground;
       font-feature-settings: "rlig" 1, "calt" 1;
       -webkit-font-smoothing: antialiased;
       -moz-osx-font-smoothing: grayscale;
       text-rendering: optimizeLegibility;
     }
   }
   
   /* =============================================================================
      TYPOGRAPHY
      ========================================================================== */
   /*
    * Font declarations are handled by next/font/local in layout.tsx
    * This eliminates layout shifts by preloading fonts at build time.
    *
    * Available CSS variables:
    * - --font-sans: IBM Plex Sans (UI, navigation)
    * - --font-serif: IBM Plex Serif (body text, headers)
    * - --font-mono: IBM Plex Mono (code blocks)
    */

   /* Book content typography - uses IBM Plex Serif for body text */
   .book-content {
     font-family: var(--font-serif), 'IBM Plex Serif', Georgia, serif;
     font-size: 1.125rem;
     line-height: 1.75;
     max-width: 65ch;
     margin: 0 auto;
   }

   .book-content p {
     margin: 0;
     padding: 0;
   }
   
   /* Fix for bento card white outlines during view transitions */
   .no-outline {
     outline: none !important;
     border-style: solid;
     transition: transform 0.3s ease, box-shadow 0.3s ease;
     -webkit-backface-visibility: hidden;
     backface-visibility: hidden;
   }
   
   .book-content h1,
   .book-content h2,
   .book-content h3,
   .book-content h4,
   .book-content h5,
   .book-content h6 {
     font-family: var(--font-serif), 'IBM Plex Serif', Georgia, serif;
     font-weight: 600;
     margin-top: 2em;
     margin-bottom: 1em;
     letter-spacing: -0.015em;
   }
   
   .book-content a {
     color: inherit;
     text-decoration: underline;
     text-decoration-thickness: 1px;
     text-underline-offset: 0.15em;
   }
   
   .book-content blockquote {
     font-style: italic;
     border-left: 3px solid currentColor;
     padding-left: 1em;
     margin-left: 0;
   }
   
   .book-content pre,
   .book-content code {
     font-family: var(--font-mono), 'IBM Plex Mono', ui-monospace, Menlo, monospace;
     background-color: hsl(var(--muted));
     padding: 0.2em 0.4em;
     border-radius: 3px;
   }
   
   .book-content img {
     max-width: 100%;
     height: auto;
     display: block;
     margin: 2em auto;
   }
   
   /* =============================================================================
      PROSE STYLES (MARKDOWN CONTENT)
      ========================================================================== */
   @layer base {
     .prose {
       @apply max-w-none text-foreground;
       font-family: var(--font-serif), 'IBM Plex Serif', Georgia, serif;
     }

     /* Headings */
     .prose h1,
     .prose h2,
     .prose h3,
     .prose h4,
     .prose h5,
     .prose h6 {
       font-family: var(--font-serif), 'IBM Plex Serif', Georgia, serif;
       font-weight: 600;
       margin-top: 2em;
       margin-bottom: 1em;
       letter-spacing: -0.015em;
       line-height: 1.2;
     }
   
     .prose h1 {
       @apply text-4xl;
     }
     .prose h2 {
       @apply text-3xl;
     }
     .prose h3 {
       @apply text-2xl;
     }
     .prose h4 {
       @apply text-xl;
     }
     .prose h5 {
       @apply text-lg;
     }
     .prose h6 {
       @apply text-base;
     }
   
     /* Paragraphs and Links */
     .prose p {
       @apply m-0 p-0 leading-relaxed;
     }
   
     .prose a {
       @apply text-primary underline transition-colors;
       text-decoration-thickness: 1px;
       text-underline-offset: 0.15em;
     }
   
     .dark .prose a {
       @apply hover:text-white;
     }
   
     /* Lists */
     .prose ul,
     .prose ol {
       @apply pl-6 mb-4;
     }
   
     .prose ul {
       @apply list-disc;
     }
   
     .prose ol {
       @apply list-decimal;
     }
   
     .prose li {
       @apply mb-2;
     }
   
     /* Blockquotes */
     .prose blockquote {
       @apply border-l-4 pl-4 italic text-muted-foreground;
     }
   
     /* Code Blocks */
     .prose code {
       font-family: var(--font-mono), 'IBM Plex Mono', ui-monospace, Menlo, monospace;
       @apply bg-muted text-muted-foreground px-1 py-0.5 rounded;
     }

     .prose pre {
       font-family: var(--font-mono), 'IBM Plex Mono', ui-monospace, Menlo, monospace;
       @apply bg-muted text-muted-foreground p-4 rounded-lg overflow-x-auto;
     }
   
     /* Images */
     .prose img {
       @apply mx-auto my-6 rounded-lg shadow;
     }
   
     /* Horizontal Rules */
     .prose hr {
       @apply border-t border-border my-6;
     }
   
     /* Tables */
     .prose table {
       @apply w-full border-collapse border border-border my-4;
     }
   
     .prose th,
     .prose td {
       @apply border border-border px-4 py-2;
     }
   
     .prose th {
       @apply bg-secondary text-secondary-foreground font-bold;
     }
   
     /* Details and Summary (for collapsible sections) */
     .prose details {
       @apply bg-muted p-4 rounded-lg shadow;
     }
   
     .prose summary {
       @apply font-semibold cursor-pointer;
     }
   
     /* Light/Dark Mode Adjustments */
     .dark .prose {
       @apply text-foreground;
     }
   
     .dark .prose code {
       @apply bg-secondary text-secondary-foreground;
     }
   
     .dark .prose pre {
       @apply bg-secondary text-secondary-foreground;
     }
   
     .dark .prose table {
       @apply border-border;
     }
   
     .dark .prose th {
       @apply bg-muted text-foreground;
     }
   }
   
   /* =============================================================================
      UTILITY CLASSES
      ========================================================================== */
   @layer utilities {
     .command-menu-open::after {
       content: "";
       position: fixed;
       top: 0;
       left: 0;
       right: 0;
       bottom: 0;
       backdrop-filter: blur(5px);
       z-index: 40;
     }
   }

/* Flip card utilities (separate layer) */
.card-3d {
  perspective: 1000px;
  -webkit-perspective: 1000px;
  height: 100%;
  width: 100%;
}

.card-3d-inner {
  display: grid;
  grid-template-areas: "stack";
  width: 100%;
  height: 100%;
  transition: transform 0.6s cubic-bezier(.2,.8,.2,1);
  transform-style: preserve-3d;
  -webkit-transform-style: preserve-3d;
}

.card-3d:hover .card-3d-inner,
.card-3d.flip .card-3d-inner {
  transform: rotateY(180deg);
}

.card-3d-front,
.card-3d-back {
  grid-area: stack;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  width: 100%;
  height: 100%;
}

.card-3d-back {
  transform: rotateY(180deg);
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: stretch;
}
   
   /* Component class to break out of layout constraints */
   .component {
     width: 100vw;
     position: relative;
     left: 50%;
     right: 50%;
     margin-left: -50vw;
     margin-right: -50vw;
     max-width: 100vw;
     overflow-x: hidden;
     display: flex;
     justify-content: center;
   }
   
   /* The actual content inside the component should be constrained */
   .component > div {
     width: 100%;
     max-width: calc(100% - 2rem);
     padding-left: 1rem;
     padding-right: 1rem;
   }
   
   @media (min-width: 768px) {
     .component > div {
       max-width: calc(100% - 4rem);
       padding-left: 2rem;
       padding-right: 2rem;
     }
   }
   
   @media (min-width: 1200px) {
     .component > div {
       max-width: 1200px;
     }
   }
   
   /* Override component styles to ensure they're not affected by parent styles */
   .component * {
     max-width: none !important;
   }
   
   /* =============================================================================
      MAP AND MARKER STYLES
      ========================================================================== */

   /* City Marker */
   .pin-city {
     background-color: rgba(236, 72, 153, 0.6);
     border-color: rgba(236, 72, 153, 0.1);
   }

   /* Place Marker */
   .pin-place {
     background-color: rgba(168, 85, 247, 0.6);
     border-color: rgba(168, 85, 247, 0.1);
   }

   /* Airport Marker */
   .pin-airport {
     background-color: rgba(244, 63, 94, 0.6);
     border-color: rgba(244, 63, 94, 0.1);
   }

   /* Country Marker */
   .pin-country {
     background-color: rgba(34, 197, 94, 0.6);
     border-color: rgba(34, 197, 94, 0.1);
   }

   /* Neighborhood Marker */
   .pin-neighborhood {
     background-color: rgba(249, 115, 22, 0.6);
     border-color: rgba(249, 115, 22, 0.1);
   }

   /* Hotel Marker */
   .pin-hotel {
     background-color: rgba(250, 204, 21, 0.6);
     border-color: rgba(250, 204, 21, 0.1);
   }

   /* Park Marker */
   .pin-park {
     background-color: rgba(16, 185, 129, 0.6);
     border-color: rgba(16, 185, 129, 0.1);
   }

   /* Building Marker */
   .pin-building {
     background-color: rgba(59, 130, 246, 0.6);
     border-color: rgba(59, 130, 246, 0.1);
   }
   
   /* Popup Styles - matching comments.tsx bento design */
   .mapboxgl-popup {
     max-width: 320px !important;
     font-family: inherit;
   }

   .mapboxgl-popup-content {
     padding: 0 !important;
     border-radius: 0 !important;
     background: hsl(var(--background)) !important;
     box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
     border: 1px solid hsl(var(--border)) !important;
     position: relative !important;
   }

   .mapboxgl-popup-tip {
     display: none !important;
   }

   /* Close button - bento cell style like comments.tsx avatar cell */
   .mapboxgl-popup-close-button {
     position: absolute !important;
     right: 0 !important;
     top: 0 !important;
     width: 2.75rem !important;
     height: 2.75rem !important;
     padding: 0 !important;
     margin: 0 !important;
     display: flex !important;
     align-items: center !important;
     justify-content: center !important;
     color: hsl(var(--muted-foreground)) !important;
     font-size: 1.25rem !important;
     font-weight: 300 !important;
     line-height: 1 !important;
     background: transparent !important;
     border: none !important;
     border-left: 1px solid hsl(var(--border)) !important;
     border-bottom: 1px solid hsl(var(--border)) !important;
     cursor: pointer !important;
     transition: all 0.15s ease !important;
   }

   .mapboxgl-popup-close-button:hover {
     color: hsl(var(--foreground)) !important;
     background: hsl(var(--muted) / 0.3) !important;
   }

   /* Location Popup Content Styles */
   .location-popup {
     min-width: 280px;
   }

   /* Bento row - flex container with stretch */
   .location-popup-row {
     display: flex;
     align-items: stretch;
     border-bottom: 1px solid hsl(var(--border));
   }

   .location-popup-row:last-child {
     border-bottom: none;
   }

   /* Icon cell - fixed width like avatar in comments */
   .location-popup-icon {
     width: 2.75rem;
     display: flex;
     align-items: center;
     justify-content: center;
     border-right: 1px solid hsl(var(--border));
     color: hsl(var(--muted-foreground));
     flex-shrink: 0;
   }

   /* Name cell - flex grow */
   .location-popup-name {
     flex: 1;
     display: flex;
     align-items: center;
     padding: 0 0.75rem;
     font-size: 0.875rem;
     font-weight: 500;
     color: hsl(var(--foreground));
     border-right: 1px solid hsl(var(--border));
     min-height: 2.75rem;
   }

   /* Type cell - fixed content width */
   .location-popup-type {
     display: flex;
     align-items: center;
     padding: 0 0.75rem;
     padding-right: 3.5rem; /* space for close button */
     font-size: 0.6875rem;
     color: hsl(var(--muted-foreground));
     text-transform: uppercase;
     letter-spacing: 0.05em;
     min-height: 2.75rem;
   }

   /* Stat cells */
   .location-popup-stat {
     flex: 1;
     padding: 0.625rem 0.75rem;
     display: flex;
     flex-direction: column;
     justify-content: center;
     gap: 0.125rem;
   }

   .location-popup-stat:first-child {
     border-right: 1px solid hsl(var(--border));
   }

   .location-popup-stat-label {
     font-size: 0.625rem;
     color: hsl(var(--muted-foreground));
     text-transform: uppercase;
     letter-spacing: 0.05em;
   }

   .location-popup-stat-value {
     font-size: 0.875rem;
     font-weight: 500;
     color: hsl(var(--foreground));
   }

   /* Description */
   .location-popup-description {
     padding: 0.75rem;
     font-size: 0.8125rem;
     color: hsl(var(--muted-foreground));
     line-height: 1.5;
     border-bottom: 1px solid hsl(var(--border));
   }

   /* Action buttons row */
   .location-popup-actions {
     border-bottom: none;
   }

   .location-popup-button {
     flex: 1;
     display: flex;
     align-items: center;
     justify-content: center;
     padding: 0.75rem;
     font-size: 0.75rem;
     font-weight: 500;
     text-align: center;
     cursor: pointer;
     transition: all 0.15s ease;
     background: transparent;
     color: hsl(var(--muted-foreground));
     border: none;
     min-height: 2.75rem;
   }

   .location-popup-button:first-child {
     border-right: 1px solid hsl(var(--border));
   }

   .location-popup-button:hover {
     background: hsl(var(--muted) / 0.3);
     color: hsl(var(--foreground));
   }
   
   /* =============================================================================
      TWEET STYLES
      ========================================================================== */
   .tweet .react-tweet-theme {
     --tweet-container-margin: 0;
     --tweet-font-family: inherit;
     --tweet-font-color: inherit;
     --tweet-bg-color: #fff;
     --tweet-bg-color-hover: #fff;
     --tweet-quoted-bg-color-hover: rgba(0, 0, 0, 0.03);
     --tweet-border: 1px solid rgb(207, 217, 222);
     --tweet-skeleton-gradient: linear-gradient(270deg, #fafafa, #eaeaea, #eaeaea, #fafafa);
     --tweet-color-red-primary: rgb(249, 24, 128);
     --tweet-color-red-primary-hover: rgba(249, 24, 128, 0.1);
     --tweet-color-green-primary: rgb(0, 186, 124);
     --tweet-color-green-primary-hover: rgba(0, 186, 124, 0.1);
     --tweet-twitter-icon-color: var(--tweet-font-color);
     --tweet-verified-old-color: rgb(130, 154, 171);
     --tweet-verified-blue-color: var(--tweet-color-blue-primary);
   }
   
   .dark .tweet .react-tweet-theme {
     --tweet-bg-color: #111;
     --tweet-bg-color-hover: #111;
     --tweet-quoted-bg-color-hover: rgba(255, 255, 255, 0.03);
     --tweet-border: 1px solid #222;
   }
   
   .tweet .react-tweet-theme p {
     font-size: inherit;
     line-height: 1.3rem;
   }
   
   .tweet .react-tweet-theme p a {
     border-bottom: 1px solid #d1d5db;
     transition-property: border-color;
     transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
     transition-duration: 150ms;
   }
   
   .tweet .react-tweet-theme p a:hover {
     border-color: #4b5563;
     text-decoration: none;
   }
   
   .dark .tweet .react-tweet-theme p a {
     color: #fff;
     border-color: #333;
   }
   
   .dark .tweet .react-tweet-theme p a:hover {
     border-color: #fff;
   }
   
   /* =============================================================================
      SCROLLBAR CONTROL
      ========================================================================== */
   /* Default scrollbar styles */
   html {
     scrollbar-gutter: stable; /* Always reserve space for scrollbar to prevent layout shift */
   }

   /* Page scrollbar - square corners */
   ::-webkit-scrollbar {
     width: 8px;
   }

   ::-webkit-scrollbar-track {
     background: hsl(var(--background));
   }

   ::-webkit-scrollbar-thumb {
     background: hsl(var(--muted-foreground) / 0.3);
     border-radius: 0; /* Square corners */
   }

   ::-webkit-scrollbar-thumb:hover {
     background: hsl(var(--muted-foreground) / 0.5);
   }

   /* Show scrollbar explicitly for blog posts and notes */
   html.show-scrollbar {
     overflow-y: scroll;
   }

   /* Hide scrollbar for regular pages while preserving space for it */
   html.hide-scrollbar {
     scrollbar-width: none; /* Firefox */
     -ms-overflow-style: none; /* IE and Edge */
   }

   /* Hide scrollbar for Webkit browsers while preserving space */
   html.hide-scrollbar::-webkit-scrollbar {
     width: 0;
     background: transparent;
     display: none;
   }

   
   /* =============================================================================
      BASE ELEMENT STYLES
      ========================================================================== */
   @layer base {
     * {
       @apply border-border;
     }
   
     body {
       @apply bg-background text-foreground;
       font-feature-settings: "rlig" 1, "calt" 1;
       -webkit-font-smoothing: antialiased;
       -moz-osx-font-smoothing: grayscale;
       text-rendering: optimizeLegibility;
     }
   }
   
   /* =============================================================================
      TARGET THE NEXT.JS IMAGE WRAPPER <SPAN> BY ITS DATA‑ATTRIBUTE
      ========================================================================== */
   span[data-nimg] {
     display: block !important;
   }
   
   /* globals.css */
   span[data-nimg]:not(.dropcap-image-wrapper span) {
     display: block !important;      /* kill inline‑block spacing */
     margin: 0 !important;           /* no margins */
     padding: 0 !important;          /* no padding */
     vertical-align: top !important; /* align it flush */
     /* leave border-radius & overflow alone */
   }
   
   img:not(.dropcap-image) {
     display: block !important;
     margin: 0 !important;
     padding: 0 !important;
     border: 0 !important;
     vertical-align: top !important;
   }
   
   .dropcap-image-wrapper {
     float: left;
     margin-right: -0.5em !important;    /* aggressive pull text closer */
     margin-top: 0 !important;
     margin-bottom: -2em !important;
     margin-left: -0.05em !important;
     line-height: 0;
     padding: 0 !important;
     display: inline-block !important;
     clear: none !important;
   }

   /* Ensure no extra space is created after the dropcap container */
   .dropcap-image-wrapper::after {
     content: none !important;
     display: none !important;
   }

   /* Ensure dropcap Next.js Image wrapper spans stay inline */
   .dropcap-image-wrapper span[data-nimg] {
     display: inline-block !important;
     margin: 0 !important;
     padding: 0 !important;
     vertical-align: top !important;
     line-height: 0 !important;
   }
   
   .dropcap-image {
     background: transparent;
     border: none;
     user-select: none;
     margin: 0 !important;   /* force remove all margins */
     padding: 0 !important;  /* force remove all padding */
     display: inline-block !important; /* override global img block display */
     vertical-align: top !important;
     /* you can also set width/height via CSS if you prefer: */
     /* width: 3em; */
     /* height: auto; */
   }

   /* Smaller dropcap for SiteInfoTabs - override negative margins */
   .dropcap-tabs.dropcap-image-wrapper {
     margin-right: 0.25em !important;
     margin-bottom: -0.8em !important;
   }

   .dropcap-image {
     /* disable any outlines, highlights, shadows, or filters */
     outline: none !important;
     box-shadow: none !important;
     filter: none !important;
     opacity: 1 !important;
     background: transparent !important;
   }
   
   .dropcap-image {
     /* make it big enough to admire — 10em is the intended size */
     width: 10em !important;
     height: 10em !important;
     /* keep it perfectly square */
     object-fit: contain;
   }
   
   /* =============================================================================
      POST CONTENT STYLES
      ========================================================================== */
   /* ensure the browser can hyphenate text in English */
   .post-content {
     hyphens: auto;
     -webkit-hyphens: auto;
     -ms-hyphens: auto;
   }
   
   /* justify all but the last line, and allow hyphenated breaks */
   .post-content p {
     text-align: justify;
     text-align-last: left;  /* keep the last line ragged-right */
     hyphens: auto;
     -webkit-hyphens: auto;
     -ms-hyphens: auto;
     margin: 0 !important;
     padding: 0 !important;
   }

   /* Ensure paragraphs containing dropcaps have no extra spacing */
   .post-content p:has(.dropcap-image-wrapper),
   .post-content p .dropcap-image-wrapper {
     margin: 0 !important;
     padding: 0 !important;
   }

   /* Ensure paragraphs after dropcaps don't add extra top margin */
   .post-content .dropcap-image-wrapper + p,
   .post-content p:has(.dropcap-image-wrapper) + p {
     margin-top: 0 !important;
   }
   
   /* Constrain FileViewer and its <pre> to 100% of whatever parent they live in */
   .post-content .file-viewer {
     width: 100% !important;
     max-width: 100% !important;
     box-sizing: border-box;
   }
   
   .post-content .file-viewer pre {
     /* force the <pre> itself to fill its container */
     width: 100% !important;
     max-width: 100% !important;
     
     /* scroll rather than overflow the page */
     overflow-x: auto !important;
     box-sizing: border-box;
   }
   
   /* (optional) wrap long words/URLs rather than overflow */
   .post-content .file-viewer code {
     word-break: break-word;
     overflow-wrap: anywhere;
   }
   
   /* =============================================================================
   LOGO THEME SWITCHING
   ========================================================================== */
/* Force logo visibility states with !important to override any conflicting styles */
/* Use higher specificity by targeting img elements directly */
img.logo-light,
span[data-nimg] img.logo-light {
  display: block !important;
  opacity: 1 !important;
  visibility: visible !important;
}

.dark img.logo-light,
.dark span[data-nimg] img.logo-light {
  display: none !important;
  opacity: 0 !important;
  visibility: hidden !important;
}

img.logo-dark,
span[data-nimg] img.logo-dark {
  display: none !important;
  opacity: 0 !important;
  visibility: hidden !important;
}

.dark img.logo-dark,
.dark span[data-nimg] img.logo-dark {
  display: block !important;
  opacity: 1 !important;
  visibility: visible !important;
}

/* =============================================================================
   MARGIN NOTES DARK MODE IMPROVEMENTS
   ========================================================================== */
/* Override Card component's default border for margin notes in dark mode */
.dark [data-note-index] {
  border-color: hsl(0 0% 20%) !important;
}

/* Improve margin notes outline colors in dark mode */
.dark [data-note-index] .border,
.dark [data-note-index] .bg-border {
  border-color: hsl(0 0% 20%) !important;
  background-color: hsl(0 0% 20%) !important;
}

.dark [data-note-index] .border-t {
  border-top-color: hsl(0 0% 20%) !important;
}

.dark [data-note-index] .border-dotted {
  border-color: hsl(0 0% 35%) !important;
}

/* Math and LaTeX styles */
.katex-display {
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
  margin: 0.5em auto !important;
  max-width: 100%;
  padding: 0 !important;
}

.katex-inline {
  display: inline;
}

/* Ensure KaTeX display math is properly centered */
.katex-display .katex {
  display: inline-block;
}

/* Override paragraph margins for math content */
.problem-content .katex-display,
.proof-content .katex-display,
p .katex-display {
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
  margin: 0.5em auto !important;
  padding: 0 !important;
}

/* =============================================================================
   PERCENTAGE-BASED UNDERLINES FOR HEADERS
   ========================================================================== */
/* Base positioning for headers that might have percentage underlines */
[class*="-content"] h1,
[class*="-content"] h2,
[class*="-content"] h3 {
  position: relative;
}

/* CSS custom properties for different percentages */
[class*="-content"] h1[data-underline-width],
[class*="-content"] h2[data-underline-width],
[class*="-content"] h3[data-underline-width] {
  overflow: hidden;
}

[class*="-content"] h1[data-underline-width]::after,
[class*="-content"] h2[data-underline-width]::after,
[class*="-content"] h3[data-underline-width]::after {
  content: '';
  position: absolute;
  bottom: 0;
  right: 0;
  width: calc(100% - var(--underline-width, 100%));
  height: 1px;
  background: var(--background, #fff);
  z-index: 2;
}

/* Dark mode version */
.dark [class*="-content"] h1[data-underline-width]::after,
.dark [class*="-content"] h2[data-underline-width]::after,
.dark [class*="-content"] h3[data-underline-width]::after {
  background: hsl(var(--background));
}

@keyframes spin-left {
  100% { transform: rotate(-360deg); }
}
@keyframes spin-right {
  100% { transform: rotate(360deg); }
}
.animate-spin-left {
  animation: spin-left 2s cubic-bezier(.4,2,.3,1) both;
}
.animate-spin-right {
  animation: spin-right 2s cubic-bezier(.4,2,.3,1) both;
}


/* Link icon styling: make icons invert/brighten in dark mode so they stay visible
   - use both .dark (class-based theme) and prefers-color-scheme for robustness */
.link-icon-img {
  filter: none;
  transition: filter 150ms ease, opacity 150ms ease;
  display: block; /* we set block inside inline wrapper to remove descender gaps */
}

.dark .link-icon-img {
  filter: invert(1) grayscale(1) brightness(2) contrast(1.1);
}

@media (prefers-color-scheme: dark) {
  .link-icon-img {
    filter: invert(1) grayscale(1) brightness(2) contrast(1.1);
  }
}

/* =============================================================================
   COMMENT CONTENT STYLES
   ========================================================================== */
.comment-content {
  font-family: var(--font-sans), 'IBM Plex Sans', system-ui, sans-serif;
  font-size: 0.875rem;
  line-height: 1.6;
  color: hsl(var(--foreground));
}

/* Headings */
.comment-content h1,
.comment-content h2,
.comment-content h3,
.comment-content h4,
.comment-content h5,
.comment-content h6 {
  font-family: var(--font-sans), 'IBM Plex Sans', system-ui, sans-serif;
  font-weight: 600;
  line-height: 1.3;
  margin-top: 1.25em;
  margin-bottom: 0.5em;
  padding-bottom: 0.3em;
  border-bottom: 1px solid hsl(var(--border));
}

.comment-content h1:first-child,
.comment-content h2:first-child,
.comment-content h3:first-child,
.comment-content h4:first-child,
.comment-content h5:first-child,
.comment-content h6:first-child {
  margin-top: 0;
}

.comment-content h1 { font-size: 1.5em; }
.comment-content h2 { font-size: 1.3em; }
.comment-content h3 { font-size: 1.15em; }
.comment-content h4 { font-size: 1em; border-bottom: none; }
.comment-content h5 { font-size: 0.95em; border-bottom: none; }
.comment-content h6 { font-size: 0.9em; border-bottom: none; color: hsl(var(--muted-foreground)); }

/* Paragraphs */
.comment-content p {
  margin: 0 0 0.75em 0;
}

.comment-content p:last-child {
  margin-bottom: 0;
}

/* Links */
.comment-content a {
  color: hsl(217, 91%, 60%);
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: border-color 0.15s ease;
}

.comment-content a:hover {
  border-bottom-color: hsl(217, 91%, 60%);
}

.dark .comment-content a {
  color: hsl(217, 91%, 70%);
}

.dark .comment-content a:hover {
  border-bottom-color: hsl(217, 91%, 70%);
}

/* Lists */
.comment-content ul,
.comment-content ol {
  margin: 0.5em 0 0.75em 0;
  padding-left: 1.5em;
}

.comment-content ul {
  list-style-type: disc;
}

.comment-content ol {
  list-style-type: decimal;
}

.comment-content li {
  margin-bottom: 0.25em;
}

.comment-content li:last-child {
  margin-bottom: 0;
}

.comment-content li > ul,
.comment-content li > ol {
  margin-top: 0.25em;
  margin-bottom: 0;
}

/* Task lists (checkboxes) */
.comment-content ul.contains-task-list {
  list-style: none;
  padding-left: 0;
}

.comment-content li.task-list-item {
  display: flex;
  align-items: flex-start;
  gap: 0.5em;
}

.comment-content li.task-list-item input[type="checkbox"] {
  margin-top: 0.3em;
}

/* Blockquotes */
.comment-content blockquote {
  margin: 0.75em 0;
  padding: 0.5em 1em;
  border-left: 3px solid hsl(var(--border));
  background: hsl(var(--muted) / 0.3);
  color: hsl(var(--muted-foreground));
  font-style: italic;
}

.comment-content blockquote p {
  margin: 0;
}

.comment-content blockquote blockquote {
  margin-top: 0.5em;
}

/* Inline code */
.comment-content code:not(pre code) {
  font-family: var(--font-mono), 'IBM Plex Mono', ui-monospace, Menlo, monospace;
  font-size: 0.85em;
  padding: 0.15em 0.4em;
  background: hsl(var(--muted));
  border-radius: 3px;
  white-space: nowrap;
}

/* Code blocks */
.comment-content pre {
  margin: 0.75em 0;
  padding: 0.75em 1em;
  background: hsl(var(--muted));
  border: 1px solid hsl(var(--border));
  border-radius: 4px;
  overflow-x: auto;
  font-size: 0.85em;
}

.comment-content pre code {
  font-family: var(--font-mono), 'IBM Plex Mono', ui-monospace, Menlo, monospace;
  background: none;
  padding: 0;
  white-space: pre;
  word-break: normal;
  overflow-wrap: normal;
}

/* Tables */
.comment-content table {
  width: 100%;
  margin: 0.75em 0;
  border-collapse: collapse;
  border: 1px solid hsl(var(--border));
  font-size: 0.85em;
}

.comment-content thead {
  background: hsl(var(--muted) / 0.5);
}

.comment-content th,
.comment-content td {
  padding: 0.5em 0.75em;
  border: 1px solid hsl(var(--border));
  text-align: left;
}

.comment-content th {
  font-weight: 600;
}

.comment-content tbody tr:nth-child(even) {
  background: hsl(var(--muted) / 0.2);
}

/* Horizontal rules */
.comment-content hr {
  margin: 1em 0;
  border: none;
  border-top: 1px solid hsl(var(--border));
}

/* Images */
.comment-content img {
  max-width: 100%;
  height: auto;
  margin: 0.75em 0;
  border-radius: 4px;
  border: 1px solid hsl(var(--border));
}

/* Strong and emphasis */
.comment-content strong {
  font-weight: 600;
}

.comment-content em {
  font-style: italic;
}

/* Strikethrough */
.comment-content del {
  text-decoration: line-through;
  color: hsl(var(--muted-foreground));
}

/* Definition lists */
.comment-content dl {
  margin: 0.75em 0;
}

.comment-content dt {
  font-weight: 600;
  margin-top: 0.5em;
}

.comment-content dd {
  margin-left: 1.5em;
  color: hsl(var(--muted-foreground));
}

/* Footnotes */
.comment-content .footnotes {
  margin-top: 1.5em;
  padding-top: 1em;
  border-top: 1px solid hsl(var(--border));
  font-size: 0.85em;
  color: hsl(var(--muted-foreground));
}

/* KaTeX/Math styling for comments */
.comment-content .katex-display {
  margin: 0.75em 0;
  overflow-x: auto;
  overflow-y: hidden;
}

.comment-content .katex {
  font-size: 1em;
}

/* Keyboard keys */
.comment-content kbd {
  display: inline-block;
  padding: 0.15em 0.4em;
  font-family: var(--font-mono), 'IBM Plex Mono', ui-monospace, Menlo, monospace;
  font-size: 0.8em;
  background: hsl(var(--muted));
  border: 1px solid hsl(var(--border));
  border-radius: 3px;
  box-shadow: inset 0 -1px 0 hsl(var(--border));
}

/* Abbreviations */
.comment-content abbr[title] {
  text-decoration: underline dotted;
  cursor: help;
}

/* Details/Summary */
.comment-content details {
  margin: 0.75em 0;
  padding: 0.5em 0.75em;
  background: hsl(var(--muted) / 0.3);
  border: 1px solid hsl(var(--border));
  border-radius: 4px;
}

.comment-content summary {
  cursor: pointer;
  font-weight: 500;
}

.comment-content details[open] summary {
  margin-bottom: 0.5em;
}

/* Superscript and subscript */
.comment-content sup,
.comment-content sub {
  font-size: 0.75em;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

.comment-content sup {
  top: -0.5em;
}

.comment-content sub {
  bottom: -0.25em;
}

/* =============================================================================
   SIDENOTES (Gwern-style)
   Based on gwern.net/static/css/default.css
   ========================================================================== */

/* CSS Variables for sidenotes */
:root {
  --sidenote-max-width: 380px;
  --sidenote-padding: 10px;
  --sidenote-border-width: 3px;
  --sidenote-border-color: hsl(var(--muted-foreground) / 0.5);
  --sidenote-highlight-color: hsl(var(--muted-foreground) / 0.7);
  --sidenote-self-link-border-color: hsl(var(--muted-foreground) / 0.5);
}

/* Sidenote Columns */
#sidenote-column-left,
#sidenote-column-right {
  position: absolute;
  top: 0;
  height: 100%;
  width: calc(50vw - (var(--content-width, 672px) / 2 + 96px));
  max-width: var(--sidenote-max-width);
  pointer-events: none;
  z-index: 1;
}

#sidenote-column-left {
  right: calc(100% + 16px);
}

#sidenote-column-right {
  left: calc(100% + 16px);
}

#sidenote-column-left:empty,
#sidenote-column-right:empty {
  display: none;
}

/* Sidenote column responsive hiding */
@media (max-width: 1399px) {
  .sidenote-column,
  #sidenote-column-left,
  #sidenote-column-right {
    display: none !important;
  }
}

/* Sidenote Blocks */
.sidenote {
  position: absolute;
  left: 0;
  width: 100%;
  opacity: 0.85;
  padding: 2em 0 0 0;
  font-size: 0.85em;
  line-height: 1.5;
  transition:
    opacity 0.25s ease-in,
    transform 0.25s ease-in,
    top 0.15s ease-out;
  pointer-events: auto;
}

.sidenote.hidden {
  display: none;
}

/* Sidenote hover/active states */
.sidenote:hover,
.sidenote.targeted,
.sidenote.displaced,
.sidenote.highlighted {
  background-color: hsl(var(--background));
  opacity: 1.0;
  box-shadow: 0 0 0 16px hsl(var(--background));
}

.sidenote.targeted {
  z-index: 1;
}

.sidenote.displaced {
  z-index: 2;
}

.sidenote.highlighted,
.sidenote:hover {
  z-index: 3;
}

/* Double border (2-lined window aesthetic) via ::after pseudo-element */
.sidenote::after {
  content: "";
  position: absolute;
  width: calc(100% + 2 * var(--sidenote-padding));
  height: calc(100% + 2 * var(--sidenote-padding));
  top: calc(-1 * (var(--sidenote-padding) + var(--sidenote-border-width)));
  left: calc(-1 * (var(--sidenote-padding) + var(--sidenote-border-width)));
  border: 0px solid hsl(var(--background));
  pointer-events: none;
  transition:
    border-color 0.15s ease 0.05s,
    border-style 0.15s ease 0.05s;
}

/* The double border appears on hover/targeted/highlighted */
.sidenote:hover::after,
.sidenote.targeted::after,
.sidenote.displaced::after,
.sidenote.highlighted::after {
  border: 3px double var(--sidenote-highlight-color);
}

/* Cut-off indicator (ellipsis for long sidenotes) */
.sidenote.cut-off::before {
  content: "…";
  position: absolute;
  border: 1px dotted var(--sidenote-border-color);
  top: calc(100% - 1px);
  left: 0;
  right: 0;
  margin: auto;
  width: fit-content;
  z-index: 2;
  background-color: hsl(var(--background));
  padding: 0.125em 0.5em 0.5em 0.5em;
  font-size: 1.25em;
  font-weight: 600;
  line-height: 0.5;
  pointer-events: none;
}

.sidenote.cut-off:hover::before {
  visibility: hidden;
}

/* Outer wrapper - dotted top/bottom borders */
.sidenote-outer-wrapper {
  max-height: 600px;
  overflow: hidden;
  position: relative;
  z-index: 1;
  border-style: dotted;
  border-color: var(--sidenote-border-color);
  border-width: 1px 0;
}

.sidenote:hover .sidenote-outer-wrapper,
.sidenote.displaced .sidenote-outer-wrapper,
.sidenote.highlighted .sidenote-outer-wrapper {
  max-height: calc(100vh - (2em + 2 * (var(--sidenote-padding) + var(--sidenote-border-width) + 2px)));
}

.sidenote.cut-off .sidenote-outer-wrapper {
  overflow-y: scroll;
  overscroll-behavior: none;
  padding-right: 0.5em;
}

/* Scrollbar styles for cut-off sidenotes */
.sidenote.cut-off .sidenote-outer-wrapper::-webkit-scrollbar {
  width: 8px;
}

.sidenote.cut-off .sidenote-outer-wrapper::-webkit-scrollbar-thumb {
  background-color: hsl(var(--muted-foreground) / 0.3);
  border-radius: 4px;
}

.sidenote.cut-off .sidenote-outer-wrapper::-webkit-scrollbar-thumb:hover {
  background-color: hsl(var(--muted-foreground) / 0.5);
}

/* Inner wrapper */
.sidenote-inner-wrapper {
  position: relative;
  margin: 0.5em 0;
}

.sidenote-inner-wrapper > * {
  position: relative;
  z-index: 1;
}

/* Sidenote self-link (boxed number badge) */
.sidenote-self-link {
  font-weight: 600;
  position: absolute;
  top: -1px;
  background-color: hsl(var(--background));
  background-image: none !important;
  border-style: dotted;
  border-color: var(--sidenote-self-link-border-color);
  border-width: 1px 1px 0px 1px;
  width: 2em;
  height: 2em;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1;
  text-decoration: none !important;
  color: hsl(var(--foreground)) !important;
  transition:
    border-color 0.15s ease 0.05s,
    border-style 0.15s ease 0.05s;
}

/* Position self-link based on column */
#sidenote-column-left .sidenote-self-link {
  right: 0;
}

#sidenote-column-right .sidenote-self-link {
  left: 0;
}

/* Self-link hover/targeted state - double border */
.sidenote.targeted > .sidenote-self-link,
.sidenote > .sidenote-self-link:hover {
  border-width: 3px;
  border-style: double;
  top: -3px;
}

#sidenote-column-left .sidenote.targeted > .sidenote-self-link,
#sidenote-column-left .sidenote > .sidenote-self-link:hover {
  right: -2px;
}

#sidenote-column-right .sidenote.targeted > .sidenote-self-link,
#sidenote-column-right .sidenote > .sidenote-self-link:hover {
  left: -2px;
}

/* Connecting line from self-link to content */
.sidenote.targeted > .sidenote-self-link::before,
.sidenote > .sidenote-self-link:hover::before {
  content: "";
  display: block;
  position: absolute;
  bottom: -3px;
  width: calc(100% + 16px);
  max-width: var(--sidenote-max-width);
  border-bottom: 3px double var(--sidenote-self-link-border-color);
  transition:
    border-color 0.15s ease 0.05s,
    border-style 0.15s ease 0.05s;
}

#sidenote-column-left .sidenote.targeted > .sidenote-self-link::before,
#sidenote-column-left .sidenote > .sidenote-self-link:hover::before {
  right: -1px;
}

#sidenote-column-right .sidenote.targeted > .sidenote-self-link::before,
#sidenote-column-right .sidenote > .sidenote-self-link:hover::before {
  left: -1px;
}

/* Citation highlighting when hovering its sidenote */
.sidenote-citation-active {
  background-color: hsl(var(--muted));
  border-radius: 2px;
  box-shadow: 0 0 0 2px hsl(var(--muted));
}

/* Sidenote content prose adjustments */
.sidenote-inner-wrapper p {
  margin: 0 0 0.5em 0;
}

.sidenote-inner-wrapper p:last-child {
  margin-bottom: 0;
}

.sidenote-inner-wrapper a {
  color: hsl(var(--foreground));
  text-decoration: underline;
  text-decoration-style: dotted;
  text-underline-offset: 2px;
}

.sidenote-inner-wrapper a:hover {
  text-decoration-style: solid;
}

/* Footnote section styling (fallback when sidenotes hidden) */
.footnotes {
  margin-top: 3rem;
  padding-top: 1.5rem;
  border-top: 1px solid hsl(var(--border));
  font-size: 0.875rem;
}

.footnotes hr {
  display: none;
}

.footnotes ol {
  padding-left: 1.5rem;
}

.footnotes li {
  margin-bottom: 0.75rem;
}

.footnotes li p {
  margin: 0;
}

/* Footnote back-reference link */
.footnote-backref {
  margin-left: 0.25rem;
  text-decoration: none;
  opacity: 0.6;
}

.footnote-backref:hover {
  opacity: 1;
}

/* =============================================================================
   FORMSMD STYLES
   ========================================================================== */
[data-survey-slug] .fmd-root {
  --fmd-main-container-width: 100%;
}

[data-survey-slug] .fmd-root .fmd-form-control:focus,
[data-survey-slug] .fmd-root .fmd-form-control:focus-visible,
[data-survey-slug] .fmd-root input:focus,
[data-survey-slug] .fmd-root input:focus-visible,
[data-survey-slug] .fmd-root textarea:focus,
[data-survey-slug] .fmd-root textarea:focus-visible {
  outline: none !important;
  box-shadow: none !important;
  border-color: inherit !important;
}

